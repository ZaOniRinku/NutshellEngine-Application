#include "external/Core/src/ntshengn_core.h"
#include "scripts/camerascript.h"

void calculateTangents(NtshEngn::Mesh& mesh) {
	std::vector<nml::vec3> tan1(mesh.vertices.size());
	std::vector<nml::vec3> tan2(mesh.vertices.size());
	for (size_t i = 0; i < mesh.indices.size(); i += 3) {
		NtshEngn::Vertex& vertex0 = mesh.vertices[mesh.indices[i]];
		NtshEngn::Vertex& vertex1 = mesh.vertices[mesh.indices[i + 1]];
		NtshEngn::Vertex& vertex2 = mesh.vertices[mesh.indices[i + 2]];

		const nml::vec3 dPos1 = nml::vec3(vertex1.position.data()) - nml::vec3(vertex0.position.data());
		const nml::vec3 dPos2 = nml::vec3(vertex2.position.data()) - nml::vec3(vertex0.position.data());

		const nml::vec2 dUV1 = nml::vec2(vertex1.uv.data()) - nml::vec2(vertex0.uv.data());
		const nml::vec2 dUV2 = nml::vec2(vertex2.uv.data()) - nml::vec2(vertex0.uv.data());

		const float r = 1.0f / (dUV1.x * dUV2.y - dUV1.y * dUV2.x);

		const nml::vec3 uDir = (dPos1 * dUV2.y - dPos2 * dUV1.y) * r;
		const nml::vec3 vDir = (dPos2 * dUV1.x - dPos1 * dUV2.x) * r;

		tan1[mesh.indices[i]] += uDir;
		tan1[mesh.indices[i + 1]] += uDir;
		tan1[mesh.indices[i + 2]] += uDir;

		tan2[mesh.indices[i]] += vDir;
		tan2[mesh.indices[i + 1]] += vDir;
		tan2[mesh.indices[i + 2]] += vDir;
	}

	for (size_t i = 0; i < mesh.vertices.size(); i++) {
		const nml::vec3 n = mesh.vertices[i].normal.data();
		const nml::vec3 t = tan1[i].data();

		const nml::vec4 tangent = nml::vec4(nml::normalize(t - n * nml::dot(n, t)),
			(nml::dot(nml::cross(n, t), tan2[i]) < 0.0f) ? -1.0f : 1.0f);

		mesh.vertices[i].tangent = { tangent.x, tangent.y, tangent.z, tangent.w };
	}
}

void scene(NtshEngn::Core& core) {
	NtshEngn::ECS* ecs = core.getECS();
	NtshEngn::AssetManager* assetManager = core.getAssetManager();

	// Create the camera
	NtshEngn::Entity camera = ecs->createEntity();

	NtshEngn::Transform& cameraTransform = ecs->getComponent<NtshEngn::Transform>(camera);
	cameraTransform.position = { 0.0f, 2.0f, 5.0f };
	cameraTransform.rotation = { 0.0f, 0.0f, -1.0f };

	NtshEngn::Camera cameraCamera;
	cameraCamera.fov = 45.0f;
	cameraCamera.nearPlane = 0.03f;
	cameraCamera.farPlane = 100.0f;
	ecs->addComponent(camera, cameraCamera);

	NtshEngn::Scriptable cameraScriptable;
	cameraScriptable.script = std::make_unique<CameraScript>();
	ecs->addComponent(camera, cameraScriptable);

	// Create a cube model
	NtshEngn::Model* cubeMesh = assetManager->createModel();
	cubeMesh->primitives.resize(1);
	cubeMesh->primitives[0].first.vertices = {
		{ {1.0f, 1.0f, -1.0f}, {0.0f, 1.0f, 0.0f}, {1.0f, 0.0f} },
		{ {-1.0f, 1.0f, -1.0f}, {0.0f, 1.0f, 0.0f}, {1.0f, 1.0f} },
		{ {-1.0f, 1.0f, 1.0f}, {0.0f, 1.0f, 0.0f}, {0.0f, 1.0f} },
		{ {1.0f, 1.0f, 1.0f}, {0.0f, 1.0f, 0.0f}, {0.0f, 0.0f} },
		{ {1.0f, -1.0f, 1.0f}, {0.0f, 0.0f, 1.0f}, {1.0f, 0.0f} },
		{ {1.0f, 1.0f, 1.0f}, {0.0f, 0.0f, 1.0f}, {1.0f, 1.0f} },
		{ {-1.0f, 1.0f, 1.0f}, {0.0f, 0.0f, 1.0f}, {0.0f, 1.0f} },
		{ {-1.0f, -1.0f, 1.0f}, {0.0f, 0.0f, 1.0f}, {0.0f, 0.0f} },
		{ {-1.0f, -1.0f, 1.0f}, {-1.0f, 0.0f, 0.0f}, {1.0f, 0.0f} },
		{ {-1.0f, 1.0f, 1.0f}, {-1.0f, 0.0f, 0.0f}, {1.0f, 1.0f} },
		{ {-1.0f, 1.0f, -1.0f}, {-1.0f, 0.0f, 0.0f}, {0.0f, 1.0f} },
		{ {-1.0f, -1.0f, -1.0f}, {-1.0f, 0.0f, 0.0f}, {0.0f, 0.0f} },
		{ {-1.0f, -1.0f, -1.0f}, {0.0f, -1.0f, 0.0f}, {1.0f, 0.0f} },
		{ {1.0f, -1.0f, -1.0f}, {0.0f, -1.0f, 0.0f}, {1.0f, 1.0f} },
		{ {1.0f, -1.0f, 1.0f}, {0.0f, -1.0f, 0.0f}, {0.0f, 1.0f} },
		{ {-1.0f, -1.0f, 1.0f}, {0.0f, -1.0f, 0.0f}, {0.0f, 0.0f} },
		{ {1.0f, -1.0f, -1.0f}, {1.0f, 0.0f, 0.0f}, {1.0f, 0.0f} },
		{ {1.0f, 1.0f, -1.0f}, {1.0f, 0.0f, 0.0f}, {1.0f, 1.0f} },
		{ {1.0f, 1.0f, 1.0f}, {1.0f, 0.0f, 0.0f}, {0.0f, 1.0f} },
		{ {1.0f, -1.0f, 1.0f}, {1.0f, 0.0f, 0.0f}, {0.0f, 0.0f} },
		{ {-1.0f, -1.0f, -1.0f}, {0.0f, 0.0f, -1.0f}, {1.0f, 0.0f} },
		{ {-1.0f, 1.0f, -1.0f}, {0.0f, 0.0f, -1.0f}, {1.0f, 1.0f} },
		{ {1.0f, 1.0f, -1.0f}, {0.0f, 0.0f, -1.0f}, {0.0f, 1.0f} },
		{ {1.0f, -1.0f, -1.0f}, {0.0f, 0.0f, -1.0f}, {0.0f, 0.0f} }
	};
	cubeMesh->primitives[0].first.indices = {
	0, 1, 2,
	0, 2, 3,
	4, 5, 6,
	4, 6, 7,
	8, 9, 10,
	8, 10, 11,
	12, 13, 14,
	12, 14, 15,
	16, 17, 18,
	16, 18, 19,
	20, 21, 22,
	20, 22, 23
	};
	calculateTangents(cubeMesh->primitives[0].first);

	NtshEngn::Image* cubeTexture = assetManager->createImage();
	cubeTexture->width = 30;
	cubeTexture->height = 30;
	cubeTexture->format = NtshEngn::ImageFormat::R8G8B8A8;
	cubeTexture->colorSpace = NtshEngn::ImageColorSpace::SRGB;
	cubeTexture->data = { 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 255, 183, 82, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255, 197, 123, 19, 255 };

	cubeMesh->primitives[0].second.diffuseTexture.first = cubeTexture;
	cubeMesh->primitives[0].second.diffuseTexture.second.magFilter = NtshEngn::ImageSamplerFilter::Nearest;
	cubeMesh->primitives[0].second.diffuseTexture.second.minFilter = NtshEngn::ImageSamplerFilter::Nearest;
	cubeMesh->primitives[0].second.diffuseTexture.second.mipmapFilter = NtshEngn::ImageSamplerFilter::Nearest;
	cubeMesh->primitives[0].second.diffuseTexture.second.anisotropyLevel = 8.0f;

	// Create a cube Entity
	NtshEngn::Entity cube = ecs->createEntity();

	NtshEngn::Renderable cubeRenderable;
	cubeRenderable.mesh = &cubeMesh->primitives[0].first;
	cubeRenderable.material = &cubeMesh->primitives[0].second;
	ecs->addComponent(cube, cubeRenderable);

	// Create lights
	// Directional Light
	NtshEngn::Entity light = ecs->createEntity();

	NtshEngn::Transform& lightTransform = ecs->getComponent<NtshEngn::Transform>(light);
	lightTransform.rotation = { 0.0f, -1.0f, 1.0f };

	NtshEngn::Light lightLight;
	lightLight.type = NtshEngn::LightType::Directional;
	lightLight.color = { 0.0f, 0.0f, 1.0f };
	ecs->addComponent(light, lightLight);

	// Point Light
	NtshEngn::Entity light2 = ecs->createEntity();

	NtshEngn::Transform& light2Transform = ecs->getComponent<NtshEngn::Transform>(light2);
	light2Transform.position = { -2.0f, 0.0f, 0.0f };

	NtshEngn::Light light2Light;
	light2Light.type = NtshEngn::LightType::Point;
	light2Light.color = { 0.0f, 1.0f, 0.0f };
	ecs->addComponent(light2, light2Light);

	// Spot Light
	NtshEngn::Entity light3 = ecs->createEntity();

	NtshEngn::Transform& light3Transform = ecs->getComponent<NtshEngn::Transform>(light3);
	light3Transform.position = { 0.0f, 1.25f, 0.0f };
	light3Transform.rotation = { 0.0f, -1.0f, 0.0f };
	light3Transform.scale = { 60.0f * 3.1415926535897932384626433832795f / 180.0f, 100.0f * 3.1415926535897932384626433832795f / 180.0f, 0.0f };

	NtshEngn::Light light3Light;
	light3Light.type = NtshEngn::LightType::Spot;
	light3Light.color = { 1.0f, 0.0f, 0.0f };
	ecs->addComponent(light3, light3Light);
}

int main() {
	NtshEngn::Core core;

	// Initialize
	core.init();

	// Scene
	scene(core);

	// Loop
	core.update();

	// Destroy
	core.destroy();

	return 0;
}